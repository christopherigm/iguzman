# ─────────────────────────────────────────────────────────────
# MongoDB – Helm Values
# ─────────────────────────────────────────────────────────────

# -- Number of old ReplicaSets to keep for rollbacks (default: 2)
revisionHistoryLimit: 2

# -- Number of pod replicas
replicaCount: 1

# ─── Container image ────────────────────────────────────────
image:
  repository: mongo
  tag: '7.0'
  pullPolicy: IfNotPresent

imagePullSecrets: []
# - name: my-registry-secret

# ─── Name overrides ─────────────────────────────────────────
nameOverride: ''
fullnameOverride: ''

# ─── Service ────────────────────────────────────────────────
service:
  type: ClusterIP
  port: 27017 # port exposed by the Service
  targetPort: 27017 # port the container listens on

# ─── MongoDB configuration ──────────────────────────────────
auth:
  rootUsername: 'root' # MONGO_INITDB_ROOT_USERNAME
  rootPassword: '' # set via --set or envFromSecret
  database: '' # optional: MONGO_INITDB_DATABASE

# ─── Environment variables ──────────────────────────────────
# Plain environment variables injected into the container.
env: {}
  # MONGO_INITDB_DATABASE: mydb

# Sensitive values – reference existing Kubernetes Secrets.
# envFromSecret:
#   - name: MONGO_INITDB_ROOT_PASSWORD
#     secretName: mongodb-secrets
#     secretKey: root-password

# ─── Host-path volume (data storage) ────────────────────────
hostPathVolume:
  enabled: true
  volumeMountPath: /shared-master # base path on the host node
  mountPath: /data/db # path inside the container

# ─── Health probes ──────────────────────────────────────────
probes:
  startupProbe:
    exec:
      command: ['mongosh', '--eval', 'db.adminCommand("ping")']
    initialDelaySeconds: 15
    periodSeconds: 10
    failureThreshold: 30
    timeoutSeconds: 10

  livenessProbe:
    exec:
      command: ['mongosh', '--eval', 'db.adminCommand("ping")']
    initialDelaySeconds: 30
    periodSeconds: 10
    failureThreshold: 20
    timeoutSeconds: 10

  readinessProbe:
    exec:
      command: ['mongosh', '--eval', 'db.adminCommand("ping")']
    initialDelaySeconds: 5
    periodSeconds: 30
    failureThreshold: 20
    timeoutSeconds: 10

# ─── Node affinity (schedule on specific nodes) ─────────────
nodeAffinity:
  enabled: true
  nodeNames:
    - master
  # - node-1
  # - node-2

# ─── Custom MongoDB configuration ───────────────────────────
# Extra mongod.conf injected via ConfigMap.
customConfig: |
  storage:
    directoryPerDB: true
  net:
    maxIncomingConnections: 200

# ─── Resources ──────────────────────────────────────────────
resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 1Gi
